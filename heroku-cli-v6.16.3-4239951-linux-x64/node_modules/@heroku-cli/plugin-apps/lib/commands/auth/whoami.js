'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _command = require('@heroku-cli/command');

var _cliUx = require('cli-ux');

class Whoami extends _command.Command {

  async run() {
    if (process.env.HEROKU_API_KEY) _cliUx.cli.warn('HEROKU_API_KEY is set');
    // flow$ignore
    if (!this.heroku.defaultOptions.headers.authorization) this.notloggedin();
    try {
      let { body: account } = await this.heroku.get('/account');
      _cliUx.cli.log(account.email);
    } catch (err) {
      if (err.statusCode === 401) this.notloggedin();
      throw err;
    }
  }

  notloggedin() {
    _cliUx.cli.error('not logged in', { exitCode: 100 });
  }
}
exports.default = Whoami;
Whoami.topic = 'auth';
Whoami.command = 'whoami';
Whoami.description = 'display the current logged in user';
Whoami.aliases = ['whoami'];